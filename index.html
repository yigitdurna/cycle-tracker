<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cycle Tracker — Calendar (v3 layout)</title>
  <meta name="theme-color" content="#ff80bf"/>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <style>
    :root{
      --bg:#f7f7f8; --card:#fff; --text:#111; --muted:#667085; --border:#e6e6e6;
      --period:#ffd6de; --fertile:#d6f5e3; --ovulation:#fff2b3; --luteal:#fdf1e3;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:960px;margin:0 auto;padding:16px}
    h1{font-size:22px;margin:0 0 10px}
    .card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .muted{color:var(--muted);font-size:12px}
    .big{font-size:32px;font-weight:800;line-height:1.05;margin:2px 0 0}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;align-items:start}
    .stat{display:flex;flex-direction:column;gap:4px;min-width:0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
    input,button{padding:10px 12px;border:1px solid var(--border);border-radius:10px}
    input{width:100%;background:#fff}
    button{background:#111;color:#fff;border:none;cursor:pointer}
    button.secondary{background:#fff;color:#111;border:1px solid var(--border)}
    .calendar-wrap{border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;justify-content:center;align-items:center;padding:8px;background:#fff}
    .flatpickr-calendar.inline{border:none;box-shadow:none;margin:0 auto}
    .flatpickr-prev-month,.flatpickr-next-month{display:none!important}
    .flatpickr-day.day-period{background:var(--period)!important}
    .flatpickr-day.day-fertile{background:var(--fertile)!important}
    .flatpickr-day.day-ovulation{background:var(--ovulation)!important;font-weight:700}
    .flatpickr-day.day-luteal{background:var(--luteal)!important}
    #calendar{position:absolute;left:-9999px;width:0;height:0;padding:0;margin:0;border:0;opacity:0}
    .legend{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;font-size:12px}
    .dot{display:inline-block;width:10px;height:10px;border-radius:999px;margin-right:6px;border:1px solid rgba(0,0,0,.08)}
    .right{text-align:right}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{text-align:left;padding:8px 6px;border-top:1px solid var(--border);vertical-align:middle}
    .hidden{display:none}
  </style>
</head>
<body>
<div class="container">
  <h1>Cycle Tracker — Calendar</h1>

  <div class="card">
    <div class="stats">
      <div class="stat">
        <div class="muted">Today</div>
        <div id="today" class="big">—</div>
        <div class="muted">Ovulation (best guess)</div>
        <div id="ovulation" class="muted" style="padding:6px 10px;border:1px solid var(--border);border-radius:999px;display:inline-block"></div>
      </div>
      <div class="stat">
        <div class="muted">Current phase</div>
        <div id="phase" class="big">—</div>
        <div id="phaseNote" class="muted"></div>
        <div class="muted">Fertile window</div>
        <div id="fertileWindow" class="muted" style="padding:6px 10px;border:1px solid var(--border);border-radius:999px;display:inline-block"></div>
      </div>
      <div class="stat">
        <div class="muted">Next period (estimate)</div>
        <div id="nextPeriod" class="big">—</div>
        <div id="daysToNext" class="muted"></div>
      </div>
    </div>
  </div>

  <div style="height:8px"></div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px">
      <div style="font-weight:600">Calendar</div>
      <div>
        <button id="prevMonth" class="secondary">◀ Prev</button>
        <button id="nextMonth" class="secondary">Next ▶</button>
      </div>
    </div>
    <div class="calendar-wrap">
      <input id="calendar" type="text"/>
    </div>
    <div class="legend">
      <div><span class="dot" style="background:var(--period)"></span>Period</div>
      <div><span class="dot" style="background:var(--fertile)"></span>Fertile window</div>
      <div><span class="dot" style="background:var(--ovulation)"></span>Ovulation (best)</div>
      <div><span class="dot" style="background:var(--luteal)"></span>Luteal</div>
    </div>

    <div class="row" style="margin-top:10px">
      <div style="flex:1 1 220px">
        <div class="muted">Selected start</div>
        <input type="text" id="selStart" readonly placeholder="Pick on calendar"/>
      </div>
      <div style="flex:1 1 220px">
        <div class="muted">Selected end</div>
        <input type="text" id="selEnd" readonly placeholder="Pick on calendar"/>
      </div>
      <div style="flex:0 0 160px">
        <button id="addCycleBtn">Add cycle</button>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="secondary" id="exportBtn">Export JSON</button>
      <button class="secondary" id="clearBtn">Clear all</button>
    </div>
  </div>

  <div style="height:8px"></div>

  <div class="card">
    <div style="font-weight:600;margin-bottom:6px">Cycle history</div>
    <div id="noRows" class="muted">No cycles yet.</div>
    <table id="tbl" class="hidden">
      <thead><tr><th>Start</th><th>End</th><th>Length (days)</th><th class="right">Actions</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
// (JS logic unchanged, omitted for brevity)
</script>
</body>
</html>